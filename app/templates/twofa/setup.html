{% extends "base_auth.html" %}
{% block title %}Aktivasi 2FA{% endblock %}

{% block content %}

<style>
.masked-box {
  font-family: monospace;
  background: #f1f3f5;
  padding: 10px 14px;
  border-radius: 6px;
  cursor: pointer;
  user-select: none;
  display: inline-block;
}

.masked-box:hover {
  background: #e9ecef;
}

.copy-hint {
  font-size: 0.85rem;
  color: #6c757d;
}
</style>

<div class="row justify-content-center">
  <div class="col-md-8 col-lg-6">

    <div class="card shadow-lg border-0">
      <div class="card-body p-4">

        <h3 class="text-center mb-2 fw-semibold">
          Aktivasi Two-Factor Authentication
        </h3>

        <p class="text-center text-muted mb-4">
          Scan QR code menggunakan
          <strong>Google Authenticator</strong>,
          <strong>Authy</strong>, atau
          <strong>Microsoft Authenticator</strong>.
        </p>

        {% if qr_base64 %}
        <div class="text-center mb-4">
          <img
            src="{{ qr_base64 }}"
            alt="QR Code 2FA"
            class="img-fluid"
            style="max-width:260px;"
          >
        </div>
        {% endif %}

        <hr>

        <!-- SECRET KEY -->
        {% if secret %}
        <p class="fw-semibold mb-1">Secret Key (Cadangan)</p>

        <div
          class="masked-box"
          data-copy="{{ secret }}"
          onclick="copySecret(this)"
          title="Klik untuk menyalin"
        >
          ********{{ secret[-4:] }}
        </div>

        <div class="copy-hint mt-1 mb-3">
          Simpan secret ini di tempat aman. Jangan dibagikan.
        </div>

        <hr>
        {% endif %}

        <!-- CONFIRM -->
        <h5 class="mt-3">Konfirmasi Aktivasi</h5>
        <p class="text-muted">
          Masukkan kode 6 digit dari aplikasi autentikator.
        </p>

        <form method="POST" action="{{ url_for('twofa.twofa_confirm', user_id=user.id) }}">
          <input type="hidden" name="secret" value="{{ secret }}">

          <input
            type="tel"
            inputmode="numeric"
            pattern="\d{6}"
            maxlength="6"
            class="form-control text-center mb-3"
            name="code"
            placeholder="123456"
            required
            autofocus
            autocomplete="one-time-code"
          >

          <button class="btn btn-primary w-100">
            Aktifkan 2FA
          </button>
        </form>

      </div>
    </div>

    <!-- ===== BACK TO LOGIN (INI YANG KAMU MAU) ===== -->
    <div class="text-center mt-4">
      <a href="{{ url_for('auth.login') }}" class="text-decoration-none">
        ‚Üê Kembali ke halaman login
      </a>
    </div>

  </div>
</div>

<script>
function copySecret(el) {
  navigator.clipboard.writeText(el.dataset.copy).then(() => {
    el.title = "Disalin!";
  });
}
</script>

{% endblock %}
